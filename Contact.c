#include"Contact.h"
void text1()
{
	printf("\t\t\t-------------欢迎使用学生管理系统------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t        1. 学生端用户         \n");
	printf("\t\t\t\t        2. 教师端用户         \n");
	printf("\t\t\t\t        3. 管理者登录         \n");
	printf("\t\t\t\t        0. 退出               \n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择:>");
}
void text2()
{
	printf("\t\t\t---------------欢迎使用学生管理系统---------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t*       1. 注册              *\n");
	printf("\t\t\t\t*       2. 登录              *\n");
	printf("\t\t\t\t*       3. 找回密码          *\n");
	printf("\t\t\t\t*       0. 返回上一页        *\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择:>");
}
void text3()
{
	printf("\t\t\t---------------欢迎使用学生管理系统---------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t*      1. 查看考试成绩       *\n");
	printf("\t\t\t\t*      2. 成绩分析           *\n");
	printf("\t\t\t\t*      3. 修改密码           *\n");
	printf("\t\t\t\t*      4. 成绩申诉           *\n");
	printf("\t\t\t\t*      0. 返回上一页         *\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择:>");
}
void text4()
{
	printf("\t\t\t---------------欢迎使用学生管理系统---------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t*      1. 录入学生信息       *\n");
	printf("\t\t\t\t*      2. 查看学生成绩       *\n");
	printf("\t\t\t\t*      3. 查询学生成绩       *\n");
	printf("\t\t\t\t*      4. 修改学生信息       *\n");
	printf("\t\t\t\t*      5. 删除学生信息       *\n");
	printf("\t\t\t\t*      6. 按成绩排序         *\n");
	printf("\t\t\t\t*      7. 成绩分析           *\n");
	printf("\t\t\t\t*      8. 查看邮箱           *\n");
	printf("\t\t\t\t*      0. 返回上一页         *\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择:>");
}
void text7()
{
	printf("\t\t\t---------------欢迎使用成绩排序功能---------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t*      1. 按总成绩排序       *\n");
	printf("\t\t\t\t*      2. 按高数成绩排序     *\n");
	printf("\t\t\t\t*      3. 按英语成绩排序     *\n");
	printf("\t\t\t\t*      4. 按C语言成绩排序    *\n");
	printf("\t\t\t\t*      0. 返回上一页         *\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择:>");
}
void text8()
{
	printf("\t\t\t---------------欢迎使用成绩查询功能---------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t*       一班  -->   1        *\n");
	printf("\t\t\t\t*       二班  -->   2        *\n");
	printf("\t\t\t\t*       三班  -->   3        *\n");
	printf("\t\t\t\t*       四班  -->   4        *\n");
	printf("\t\t\t\t*       五班  -->   5        *\n");
	printf("\t\t\t\t*       综合  -->   6        *\n");
	printf("\t\t\t\t*       返回  -->   0        *\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择您要查询的班级:>");
}
void text9()
{
	printf("\t\t\t---------------欢迎使用成绩排序功能---------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t*       一班  -->   1        *\n");
	printf("\t\t\t\t*       二班  -->   2        *\n");
	printf("\t\t\t\t*       三班  -->   3        *\n");
	printf("\t\t\t\t*       四班  -->   4        *\n");
	printf("\t\t\t\t*       五班  -->   5        *\n");
	printf("\t\t\t\t*       综合  -->   6        *\n");
	printf("\t\t\t\t*       返回  -->   0        *\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择您要排序的班级:>");
}
void text10()
{
	printf("\t\t\t---------------欢迎使用成绩分析功能---------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t*       一班  -->   1        *\n");
	printf("\t\t\t\t*       二班  -->   2        *\n");
	printf("\t\t\t\t*       三班  -->   3        *\n");
	printf("\t\t\t\t*       四班  -->   4        *\n");
	printf("\t\t\t\t*       五班  -->   5        *\n");
	printf("\t\t\t\t*       综合  -->   6        *\n");
	printf("\t\t\t\t*       返回  -->   0        *\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择您要分析的班级:>");
}
void text11()
{
	printf("\t\t\t---------------欢迎使用学生管理系统---------------\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t*      1. 教师手机号授权     *\n");
	printf("\t\t\t\t*      2. 删除已授权手机号   *\n");
	printf("\t\t\t\t*      3. 查看教师账号信息   *\n");
	printf("\t\t\t\t*      0. 返回上一页         *\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择:>");
}
Node* InitList()
{
	Node* head=(Node*)malloc(sizeof(Node));
	head->next = NULL;
	FILE* fp = fopen("text.txt", "rb");
	Node* s = (Node*)malloc(sizeof(Node));
	Node* r=head;
	while (fread(s, sizeof(Node), 1, fp)==1)
	{
		r->next = s;
		r = s;
	    s = (Node*)malloc(sizeof(Node));
	}
	rewind(fp);
	fclose(fp);
	r->next = NULL;
	return head;
}
void GreatbyRear(Node* head) {
	system("cls");
	char i[20];
	Node * s,*r;
	r = head;
	while (r->next != NULL)
	{
		r = r->next;
	}
	char math[5];
	char English[5];
	char CL[5];
	Node* cur = head;
	while (1) {
		s = (Node*)calloc(1,sizeof(Node));
		//输入姓名
		printf("\t\t\t\t请输入该学生姓名(输入exit退出录入系统):>");
		scanf("%s", s->name);
		if (strcmp(s->name, "exit") == 0)
		{
			system("cls");
			return;
		}
		system("cls");
		//输入学号
		printf("\t\t\t\t请输入学生学号(例如 03211)(输入exit退出录入系统):>");
		while (1) {
			int flag = 0;
			int flag1 = 0;
			scanf("%s", s->number);
			if (strcmp(s->number, "exit") == 0)
			{
				system("cls");
				return;
			}
			if (strlen(s->number) != 5) {
				printf("\t\t\t\t学号要求5位数字！\n");
				system("pause");
				system("cls");
				return;
			}
			for (int j = 0; j < 5; j++) {
				if (s->number[j] < '0' || s->number[j]>'9') {
					printf("\t\t\t\t学号要求5位数字！\n");
					flag = 1;
					system("pause");
					system("cls");
					return;
				}
			}
			if (flag == 0) {
				Node* newhead = head->next;
				while (newhead!=NULL)
				{
					if (strcmp(newhead->number, s->number) == 0)
					{
						printf("\t\t\t\t该学号已被录入！\n");
						flag1 = 1;
						system("pause");
				        system("cls");
						return;
					}
					newhead = newhead->next;
				}
				if (flag1 == 0)
				{
					break;
				}
			}
		}
		system("cls");
		//输入班级
		printf("\t\t\t\t请输入该学生班级(例如：2106)(输入exit退出录入系统):>");
		while (1) {
			int flag = 0;
			scanf("%s", s->Class);
			if (strcmp(s->Class, "exit") == 0)
			{
				system("cls");
				return;
			}
			if (strlen(s->Class) != 4) {
				printf("\t\t\t\t请输入正确的班级(输入exit退出录入系统):>");
				continue;
			}
			for (int j = 0; j < 4; j++) {
				if (s->Class[j] < '0' || s->Class[j]>'9') {
					printf("\t\t\t\t请输入正确的班级(输入exit退出录入系统):>");
					flag = 1;
					break;
				}
			}
			if (flag == 0) {
				if (s->Class[0] != '2' || s->Class[1] != '1' || s->Class[2] != '0' || s->Class[3] < '0' || s->Class[3]>'5')
				{
					printf("\t\t\t\t您只有管理2101班至2105班的权限！\n");
					printf("\t\t\t\t请输入正确的班级(输入exit退出录入系统):>");
					continue;
				}
				break;
			}
		}
		system("cls");
		//输入数学成绩
		printf("\t\t\t\t请输入该学生的高数成绩(输入exit退出录入系统):>");
		while (1) {
			int flag = 0;
			scanf("%s", math);
			if (strcmp(math, "exit"))
			{
				system("cls");
				return;
			}
			if (strlen(math) >= 3 && strcmp(math, "100") != 0) {
				printf("\t\t\t\t请输入正确的高数成绩(输入exit退出录入系统):>");
				continue;
			}
			for (int j = 0; j < 2; j++) {
				if (math[j] == '\0') {
					break;
				}
				if (math[j] < '0' || math[j]>'9') {
					printf("\t\t\t\t请输入正确的高数成绩(输入exit退出录入系统):>");
					flag = 1;
					break;
				}
			}
			if (flag == 0) {
				if (strlen(math) == 1) {
					s->math = math[0] - '0';
				}
				else if (strlen(math) == 2) {
					s->math = (math[0] - '0') * 10 + (math[1] - '0');
				}
				else
					s->math = 100;
				break;
			}
		}
		system("cls");
		//输入英语成绩
		printf("\t\t\t\t请输入该学生的英语成绩(输入exit退出录入系统):>");
		while (1) {
			int flag = 0;
			scanf("%s", English);
			if (strcmp(English, "exit"))
			{
				system("cls");
				return;
			}
			if (strlen(English) >= 3 && strcmp(English, "100") != 0) {
				printf("\t\t\t\t请输入正确的英语成绩(输入exit退出录入系统):>");
				continue;
			}
			for (int j = 0; j < 2; j++) {
				if (English[j] == '\0') {
					break;
				}
				if (English[j] < '0' || English[j]>'9') {
					printf("\t\t\t\t请输入正确的英语成绩(输入exit退出录入系统):>\n");
					flag = 1;
					break;
				}
			}
				if (flag == 0) {
					if (strlen(English) == 1) {
						s->English = English[0] - '0';
					}
					else if (strlen(English) == 2) {
						s->English = (English[0] - '0') * 10 + (English[1] - '0');
					}
					else
						s->English = 100;
					break;
				}
			}
		system("cls");
		//输入C语言成绩
		printf("\t\t\t\t请输入该学生的C语言成绩(输入exit退出录入系统):>");
		while (1) {
			int flag = 0;
			scanf("%s", CL);
			if (strcmp(CL, "exit"))
			{
				system("cls");
				return;
			}
			if (strlen(CL) >= 3 && strcmp(CL, "100") != 0) {
				printf("\t\t\t\t请输入正确的C语言成绩(输入exit退出录入系统):>");
				continue;
			}
			for (int j = 0; j < 2; j++) {
				if (CL[j] == '\0') {
					break;
				}
				if (CL[j] < '0' || CL[j]>'9') {
					printf("\t\t\t\t请输入正确的C语言成绩(输入exit退出录入系统):>");
					flag = 1;
					break;
				}
			}
				if (flag == 0) {
					if (strlen(CL) == 1) {
						s->CL = CL[0] - '0';
					}
					else if (strlen(CL) == 2) {
						s->CL = (CL[0] - '0') * 10 + (CL[1] - '0');
					}
					else
						s->CL = 100;
					break;
				}
			}
		system("cls");
		s->total = s->English + s->math + s->CL;
		printf("\t\t\t\t添加成功！\n");
		r->next = s;
		r = s;
		printf("\t\t\t\t-------1 继续添加    2 退出-------\n");
		while (1) {
			printf("\t\t\t\t请输入:>");
			scanf("%s", i);
			if (strcmp(i, "1") == 0) 
			{
				system("cls");
				break;
			}
			else if (strcmp(i, "2") == 0) 
			{
				r->next = NULL;
				FILE* fp1 = fopen("text.txt", "wb");
				FILE* fp2 = fopen("class1.txt", "wb");
				FILE* fp3 = fopen("class2.txt", "wb");
				FILE* fp4 = fopen("class3.txt", "wb");
				FILE* fp5 = fopen("class4.txt", "wb");
				FILE* fp6 = fopen("class5.txt", "wb");
				cur = cur->next;
				while (cur != NULL)
				{
					fwrite(cur, sizeof(Node), 1, fp1);
					if (cur->Class[3] == '1') {
						fwrite(cur, sizeof(Node), 1, fp2);
					}
					if (cur->Class[3] == '2') {
						fwrite(cur, sizeof(Node), 1, fp3);
					}
					if (cur->Class[3] == '3') {
						fwrite(cur, sizeof(Node), 1, fp4);
					}
					if (cur->Class[3] == '4') {
						fwrite(cur, sizeof(Node), 1, fp5);
					}
					if (cur->Class[3] == '5') {
						fwrite(cur, sizeof(Node), 1, fp6);
					}
					cur = cur->next;
				}
				rewind(fp1);
				fclose(fp1);
				system("cls");
				return;
			}
			else 
			{
				printf("输入错误，请重新输入！\n");
			}
		}
	}
}
void Register_Tea()
{
	system("cls");
	printf("\t\t\t\t-----------欢迎使用学生管理系统注册功能------------\n");
	FILE* fp = fopen("user.txt", "rb");
	if (fp == NULL)
	{
		printf("打开文件失败！");
		return;
	}
	User a, b;
	printf("\t\t\t\t请输入11位的电话号码(输入exit退出注册系统):>");
	int flag = 0;
	while (1)
	{
		scanf("%s", a.number);
		if (strcmp(a.number, "exit")==0)
		{
			system("cls");
			fclose(fp);
			return;
		}
		if (strlen(a.number) != 11)
		{
			printf("\t\t\t\t格式错误！\n");
			printf("\t\t\t\t请重新输入(输入exit退出注册系统):>");
			continue;
		}
		for(int i = 0; i < 11; i++)
		{
			if (a.number[i] >= '0' && a.number[i] <= '9')
			{
				flag = 0;
				continue;
			}
			else
			{
				printf("\t\t\t\t格式错误！\n");
				printf("\t\t\t\t请重新输入(输入exit退出注册系统):>");	
				flag = 1;
				break;
			
			}

		}
		if (flag == 0)
		{
			char number2[20];
			FILE* fp3 = fopen("phone.txt","rb");
			while (fread(number2, sizeof(number2), 1, fp3)==1)
			{
				if (strcmp(number2, a.number)==0)
				{
					flag = 1;
					break;
				}
			}
			if (flag == 0)
			{
				printf("\t\t\t\t该电话号未被授权!\n");
				fclose(fp3);
				fclose(fp);
				system("pause");
				system("cls");
				return;
			}
			fclose(fp3);
			break;
	    }
	}
	printf("\t\t\t\t请输入姓名:>");
	scanf("%s", a.name);
	if (strcmp(a.name, "exit") == 0)
	{
		system("cls");
		fclose(fp);
		return;
	}
	system("cls");
	printf("\t\t\t\t请输入账号(8位)(输入exit退出注册系统):>");
	scanf("%s", a.account);
	if (strcmp(a.account, "exit") == 0)
	{
		system("cls");
		fclose(fp);
		return;
	}
	while (1)
	{
		if (strlen(a.account) != 8)
		{
			printf("\t\t\t\t格式错误！\n");
			printf("\t\t\t\t请重新输入账号:>");
			scanf("%s", a.account);
			if (strcmp(a.account, "exit") == 0)
			{
				system("cls");
				fclose(fp);
				return;
			}
			continue;
		}
		if (fread(&b, sizeof(User), 1, fp) != 1)
		{
			while (1)
			{
				char c[15];
				printf("\t\t\t\t请输入密码(6位至12位):>");
				scanf("%s", a.password);
				if (strcmp(a.password, "exit") == 0)
				{
					fclose(fp);
					system("cls");
					return;
				}
				if (strlen(a.password) < 6 || strlen(a.password) > 12)
				{
					printf("\t\t\t\t格式错误！\n");
					continue;
				}
				printf("\t\t\t\t请再次确认密码:>");
				scanf("%s", c);
				if (strcmp(c, "exit") == 0)
				{
					system("cls");
					fclose(fp);
					return;
				}
				if (strcmp(c, a.password) == 0)
				{
					printf("\t\t\t\t注册成功！\n");
					system("pause");
					system("cls");
					fclose(fp);
					break;
				}
				else
				{
					printf("\t\t\t\t两次密码不一致！\n");
					continue;
				}
			}
			fp = fopen("user.txt", "ab");
			fwrite(&a, sizeof(User), 1, fp);
			fclose(fp);
			return;
		}
		if (strcmp(a.account, b.account) == 0)
		{
			printf("\t\t\t\t该账号已被注册！\n");
			printf("\t\t\t\t请重新输入账号(输入exit退出注册系统):>");
			scanf("%s", a.account);
			if (strcmp(a.account, "exit") == 0)
			{
				fclose(fp);
				system("cls");
				return;
			}
			rewind(fp);
			continue;
		}
	}
}
int Login_Tea()
{
	FILE* fp = fopen("user.txt", "rb");
	User a, b;
	system("cls");
	printf("\t\t\t\t-----------欢迎使用学生管理系统登录功能------------\n");
	printf("\t\t\t\t请输入账号(输入exit退出登录系统):>");
	scanf("%s", a.account);
	if (strcmp(a.account, "exit") == 0)
	{
		system("cls");
		fclose(fp);
		return 0;
	}
	while (1)
	{
		if (fread(&b, sizeof(User), 1, fp)==1)
		{
			if (strcmp(a.account, b.account) == 0)
			{
				while (1)
				{
					printf("\t\t\t\t请输入密码(输入exit退出登录系统):>");
					scanf("%s", a.password);
					if (strcmp(a.password, "exit") == 0)
					{
						system("cls");
						fclose(fp);
						return 0;
					}
					if (strcmp(a.password, b.password) != 0)
					{
						printf("\t\t\t\t密码错误！\n");
						continue;
					}
					else
					{
						printf("\t\t\t\t登录成功！");
						Sleep(1000);
						system("cls");
						printf("\t\t\t%s，欢迎使用学生管理系统！\n", b.name);
						fclose(fp);
						system("pause");
						system("cls");
						return 1;
					}
				}
			}
			else
			{
				continue;
			}
		}
		printf("\t\t\t\t该学号未注册！\n");
		printf("\t\t\t\t请重新输入账号(输入exit退出登录系统):>");
		scanf("%s", a.account);
		if (strcmp(a.account, "exit") == 0)
		{
			system("cls");
			fclose(fp);
			return 0;
		}
		rewind(fp);
	}
}
void Retrieve_Tea()
{
	system("cls");
	User a, b;
	printf("\t\t\t\t-----------欢迎使用学生管理系统找回密码功能------------\n");
	FILE* fp = fopen("user.txt", "rb");
	printf("\t\t\t\t请输入账号(输入exit退出找回密码功能):>");
	scanf("%s", a.account);
	if (strcmp(a.account, "exit") == 0)
	{
		system("cls");
		fclose(fp);
		return;
	}
	while (1)
	{
		if (fread(&b, sizeof(User), 1, fp)==1)
		{
			if (strcmp(a.account, b.account) == 0)
			{
				printf("\t\t\t\t请输入电话号码(输入exit退出找回密码功能):>");
				scanf("%s", a.number);
				if (strcmp(a.number, "exit") == 0)
				{
					system("cls");
					fclose(fp);
					return;
				}
				if (strcmp(a.number, b.number) == 0)
				{
					printf("\t\t\t\t密码找回成功！\n");
					printf("\t\t\t\t您的密码是：%s\n", b.password);
					fclose(fp);
					system("pause");
					system("cls");
					break;
				}
				else
				{
					printf("\t\t\t\t电话号码错误！\n");
					printf("\t\t\t\t密码找回失败！\n");
					printf("\t\t\t\t将在2秒后返回！\n");
					fclose(fp);
					Sleep(2000);
					system("cls");
					break;
				}
			}
			continue;
		}
		printf("\t\t\t\t该学号未注册！\n");
		printf("\t\t\t\t请重新输入学号(输入exit退出找回密码功能):>");
		scanf("%s", a.account);
		if (strcmp(a.account, "exit") == 0)
		{
			system("cls");
			fclose(fp);
			return;
		}
		rewind(fp);
	}
}
void ChangePass_Tea()
{
	FILE* fp = fopen("user.txt", "rb");
	User a, b;
	system("cls");
	printf("\t\t\t\t-----------欢迎使用学生管理系统修改密码功能------------\n");
	printf("\t\t\t\t请输入账号(输入exit退出修改密码功能):>");
	scanf("%s", a.account);
	if (strcmp(a.account, "exit") == 0)
	{
		system("cls");
		fclose(fp);
		return;
	}
	while (1)
	{
		if (fread(&b, sizeof(User), 1, fp) == 1)
		{
			if (strcmp(a.account, b.account) == 0)
			{
				while (1)
				{
					printf("\t\t\t\t请输入原先密码(输入exit退出修改密码功能):>");
					scanf("%s", a.password);
					if (strcmp(a.password, "exit") == 0)
					{
						system("cls");
						fclose(fp);
						return;
					}
					if (strcmp(a.password, b.password) != 0)
					{
						printf("\t\t\t\t密码错误！\n");
						continue;
					}
					else
					{
						while (1)
						{
							char c[15];
							printf("\t\t\t\t请输入新密码(6位至12位)(输入exit退出修改密码功能):>");
							scanf("%s", a.password);
							if (strcmp(a.password, "exit")==0)
							{
								system("cls");
								fclose("fp");
								return;
							}
							if (strlen(a.password) < 6 || strlen(a.password) > 12)
							{
								printf("\t\t\t\t格式错误！\n");
								continue;
							}
							printf("\t\t\t\t请再次确认密码(输入exit退出修改密码功能):>");
							scanf("%s", c);
							if (strcmp(c, "exit")==0)
							{
								system("cls");
								fclose(fp);
								return;
							}
							if (strcmp(c, a.password) == 0)
							{
								printf("\t\t\t\t修改成功！\n");
								rewind(fp);
								User* head=(User*)malloc(sizeof(User));
								User* s = (User*)malloc(sizeof(User));
								User* r=head;
								while (fread(s, sizeof(User), 1, fp) == 1)
								{
									if (strcmp(s->account, a.account)==0)
									{
										strcpy(s->password, a.password);
									}
									r->next=s;
									r = r->next;
									s = (User*)malloc(sizeof(User));
								}
								r->next = NULL;
								rewind(fp);
                                fclose(fp);
								User* cur = head;
								fp = fopen("user.txt", "wb");
								cur = cur->next;
								while (cur != NULL)
								{
									fwrite(cur, sizeof(User), 1, fp);
									cur = cur->next;
								}
								rewind(fp);
								fclose(fp);
								system("pause");
								system("cls");
								return 0;
							}
							else
							{
								printf("\t\t\t\t两次密码不一致！\n");
								continue;
							}
						}
					}
				}
			}
			else
			{
				continue;
			}
		}
		printf("\t\t\t\t该账号未注册！\n");
		printf("\t\t\t\t请重新输入账号(输入exit退出修改密码功能):>");
		scanf("%s", a.account);
		if (strcmp(a.account, "exit")==0)
		{
			fclose(fp);
			system("cls");
			return;
		}
		rewind(fp);
	}
}
void Register_Stu()
{
	system("cls");
	printf("\t\t\t\t-----------欢迎使用学生管理系统注册功能------------\n");
	FILE* fp = fopen("text.txt", "rb");
	if (fp == NULL)
	{
		printf("打开文件失败！");
		return;
	}
	Node a;
	Node b;
	printf("\t\t\t\t请输入学号(输入exit退出注册功能):>");
	scanf("%s", a.number);
	if (strcmp(a.number, "exit")==0)
	{
		system("cls");
		fclose("fp");
		return;
	}
	if (strlen(a.number) != 5) {
		printf("\t\t\t\t学号格式不正确！\n");
		system("pause");
		system("cls");
		fclose(fp);
		return;
	}
	for (int j = 0; j < 5; j++) {
		if (a.number[j] < '0' || a.number[j]>'9') {
			printf("\t\t\t\t学号格式不正确！\n");
			system("pause");
			system("cls");
			fclose(fp);
			return;
		}
	}
	while (fread(&b, sizeof(Node), 1, fp) == 1)
	{
		if (strncmp(a.number, b.number, 5) == 0)
		{
			printf("\t\t\t\t请输入姓名(输入exit退出注册功能):>");
			scanf("%s", a.name);
			if (strcmp(a.name, "exit")==0)
			{
				system("cls");
				fclose("fp");
				return;
			}
			if (strcmp(a.name, b.name) == 0)
			{
				while (1)
				{
					char c[15];
					User_stu d;
					printf("\t\t\t\t请输入密码(输入exit退出注册功能)(6位至12位):>");
					scanf("%s", d.password);
					if (strcmp(d.password, "exit")==0)
					{
						system("cls");
						fclose("fp");
						return;
					}
					if (strlen(d.password) < 6 || strlen(d.password) > 12)
					{
						printf("\t\t\t\t格式错误！\n");
						continue;
					}
					printf("\t\t\t\t请再次确认密码(输入exit退出注册功能):>");
					scanf("%s", c);
					if (strcmp(c, "exit")==0)
					{
						system("cls");
						fclose("fp");
						return;
					}
					if (strcmp(c, d.password) == 0)
					{
						printf("\t\t\t\t注册成功！\n");
						strcpy(d.number, b.number);
						strcpy(d.name, b.name);
						FILE* fp2 = fopen("user_stu.txt", "ab");
						if (fp2 == NULL)
						{
							printf("打开文件失败！");
							return;
						}
						fwrite(&d, sizeof(User_stu), 1, fp2);
						system("pause");
						system("cls");
						fclose(fp);
						fclose(fp2);
						return;
					}
					else
					{
						printf("\t\t\t\t两次密码不一致,请重新输入!\n");
						continue;
					}
				}
				fclose(fp);
				return;
			}
			else {
				printf("\t\t\t\t姓名与学号不对应！\n");
				system("pause");
				fclose(fp);
				system("cls");
				return;
			}

		}
	}
	printf("\t\t\t\t该学号未被登记！\n");
	fclose(fp);
	system("pause");
	system("cls");
	return;
}


void Login_Stu()
{
	FILE* fp = fopen("user_stu.txt", "rb");
	User_stu a, b;
	system("cls");
	printf("\t\t\t\t-----------欢迎使用学生管理系统登录功能------------\n");
	printf("\t\t\t\t请输入学号(输入exit退出登录功能):>");
	scanf("%s", a.number);
	if (strcmp(a.number, "exit") == 0)
	{
		system("cls");
		fclose(fp);
		return;
	}
	while (1)
	{
		if (fread(&b, sizeof(User_stu), 1, fp) == 1)
		{
			if (strcmp(a.number, b.number) == 0)
			{
				while (1)
				{
					printf("\t\t\t\t请输入密码(输入exit退出登录功能):>");
					scanf("%s", a.password);
					if (strcmp(a.password, "exit") == 0)
					{
						system("cls");
						fclose(fp);
						return;
					}
					if (strcmp(a.password, b.password) != 0)
					{
						printf("\t\t\t\t密码错误！\n");
						continue;
					}
					else
					{
						printf("\t\t\t\t登录成功！");
						Sleep(1000);
						system("cls");
						printf("\t\t\t%s，欢迎使用学生管理系统！", b.name);
						fclose(fp);
						Sleep(2000);
						Use_Stu(a.number);
						system("cls");
						return;
					}
				}
			}
			else
			{
				continue;
			}
		}
		printf("\t\t\t\t该学号未注册！\n");
		printf("\t\t\t\t请重新输入学号(输入exit退出登录功能):>");
		scanf("%s", a.number);
		if (strcmp(a.number, "exit") == 0)
		{
			system("cls");
			fclose(fp);
			return;
		}
		rewind(fp);
	}
}
void Retrieve_Stu()
{
	system("cls");
	User_stu a, b;
	printf("\t\t\t\t-----------欢迎使用学生管理系统找回密码功能------------\n");
	FILE* fp = fopen("user_stu.txt", "rb");
	printf("\t\t\t\t请输入学号(输入exit退出找回密码功能):>");
	scanf("%s", a.number);
	if (strcmp(a.number, "exit") == 0)
	{
		fclose(fp);
		system("cls");
		return;
	}
	while (1)
	{
		if (fread(&b, sizeof(User_stu), 1, fp) == 1)
		{
			if (strcmp(a.number, b.number) == 0)
			{
				printf("\t\t\t\t请输入您的姓名:>");
				scanf("%s", a.name);
				if (strcmp(a.name, b.name) == 0)
				{
					printf("\t\t\t\t密码找回成功！\n");
					printf("\t\t\t\t您的密码是：%s\n", b.password);
					fclose(fp);
					system("pause");
					system("cls");
					return;
				}
				else
				{
					printf("\t\t\t\t姓名与学号不对应！\n");
					printf("\t\t\t\t密码找回失败！\n");
					fclose(fp);
					system("pause");
					system("cls");
					return;
				}
			}
			continue;
		}
		printf("\t\t\t\t该学号未注册！\n");
		fclose(fp);
		system("pause");
		system("cls");
		return;
		rewind(fp);
	}
}
void ChangePass_Stu()
{
	FILE* fp = fopen("user_stu.txt", "rb");
	User_stu a, b;
	system("cls");
	printf("\t\t\t\t-----------欢迎使用学生管理系统修改密码功能------------\n");
	printf("\t\t\t\t请输入账号(输入exit退出修改密码功能):>");
	scanf("%s", a.number);
	if (strcmp(a.number, "exit") == 0)
	{
		fclose(fp);
		system("cls");
		return;
	}
	while (1)
	{
		if (fread(&b, sizeof(User_stu), 1, fp) == 1)
		{
			if (strcmp(a.number, b.number) == 0)
			{
				while (1)
				{
					printf("\t\t\t\t请输入原先密码(输入exit退出修改密码功能):>");
					scanf("%s", a.password);
					if (strcmp(a.password, "exit") == 0)
					{
						fclose(fp);
						system("cls");
						return;
					}
					if (strcmp(a.password, b.password) != 0)
					{
						printf("\t\t\t\t密码错误！\n");
						continue;
					}
					else
					{
						while (1)
						{
							char c[15];
							printf("\t\t\t\t请输入新密码(6位至12位)(输入exit退出修改密码功能):>");
							scanf("%s", a.password);
							if (strcmp(a.password, "exit") == 0)
							{
								fclose(fp);
								system("cls");
								return;
							}
							if (strlen(a.password) < 6 || strlen(a.password) > 12)
							{
								printf("\t\t\t\t格式错误！\n");
								continue;
							}
							printf("\t\t\t\t请再次确认密码(输入exit退出修改密码功能):>");
							scanf("%s", c);
							if (strcmp(c, "exit") == 0)
							{
								fclose(fp);
								system("cls");
								return;
							}
							if (strcmp(c, a.password) == 0)
							{
								printf("\t\t\t\t修改成功！\n");
								rewind(fp);
								User_stu* head = (User_stu*)malloc(sizeof(User_stu));
								User_stu* s = (User_stu*)malloc(sizeof(User_stu));
								User_stu* r = head;
								while (fread(s, sizeof(User_stu), 1, fp) == 1)
								{
									if (strcmp(s->number, a.number) == 0)
									{
										strcpy(s->password, a.password);
									}
									r->next = s;
									r = r->next;
									s = (User_stu*)malloc(sizeof(User_stu));
								}
								r->next = NULL;
								rewind(fp);
								fclose(fp);
								User_stu* cur = head;
								fp = fopen("user_stu.txt", "wb");
								cur = cur->next;
								while (cur != NULL)
								{
									fwrite(cur, sizeof(User_stu), 1, fp);
									cur = cur->next;
								}
								rewind(fp);
								fclose(fp);
								system("pause");
								system("cls");
								return 0;
							}
							else
							{
								printf("\t\t\t\t两次密码不一致！\n");
								continue;
							}
						}
					}
				}
			}
			else
			{
				continue;
			}
		}
		printf("\t\t\t\t该学号未注册！\n");
		printf("\t\t\t\t请重新输入账号(输入exit退出修改密码功能):>");
		scanf("%s", a.number);
		if (strcmp(a.number, "exit") == 0)
		{
			fclose(fp);
			system("cls");
			return;
		}
		rewind(fp);
	}
}
void OutPut(Node*head,char* x)
{
	int i = 1;
	Node* p = head->next;
	printf(" \t\t\t ___________________________________________________________________________________\n");
	printf(" \t\t\t|   序号   |  姓名   |   班级   |     学号     | 高数   | 英语  |  C语言  |   总分  |\n");
	while (p != NULL)
	{
		if (strcmp(x,p->Class) == 0||strcmp(x,"1111")==0)
		{
			printf(" \t\t\t|―――――――――――-----------――――――――――――――----------------------|\n");
			printf(" \t\t\t|    %-3d   |  %-6s |   %s   |     %s    |  %-3d   |  %-3d  |   %-3d   |   %-3d   |\n", i, p->name, p->Class, p->number, p->math, p->English, p->CL, p->total);
			i++;
		}
		p = p->next;
		
	}
	printf(" \t\t\t|___________________________________________________________________________________|\n");
}
void OutPut2(Node* head)
{
	
	while (1)
	{
		system("cls");
		text8();
		char j[20];
		int b;
		scanf("%s", j);
		if (strlen(j) != 1)
		{
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
			continue;
		}
		b = j[0] - '0';
		switch (b)
		{
		case 1:
			OutPut(head, "2101");
			system("pause");
			system("cls");
			break;
		case 2:
			OutPut(head, "2102");
			system("pause");
			system("cls");
			break; 
		case 3:
			OutPut(head, "2103");
			system("pause");
			system("cls");
			break;
		case 4:
			OutPut(head, "2104");
			system("pause");
			system("cls");
			break;
		case 5:
			OutPut(head, "2105");
			system("pause");
			system("cls");
			break;
		case 6:
			OutPut(head, "1111");
			system("pause");
			system("cls");
			break;
		case 0://返回上一页
			system("cls");
			return ;
		default:
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
			break;
		}
	}
}
void text6(Node*p)
{
	printf("\t\t\t--------------------欢迎使用学生信息修改功能---------------------\n");
	printf("\t\t\t该学生信息为:\n");
	printf("\t\t\t ________________________________________________________________________\n");
	printf("\t\t\t|  姓名   |   班级   |     学号     | 高数   | 英语  |  C语言  |   总分  |\n");
	printf("\t\t\t|―――――――――――-----------――――――――――――――-----------|\n");
	printf("\t\t\t|  %-6s |     %s    |   %s   |  %-3d   |  %-3d  |   %-3d   |   %-3d   |\n", p->name, p->Class, p->number, p->math, p->English, p->CL, p->CL+p->English+p->math);
	printf("\t\t\t|________________________________________________________________________|\n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t        1. 修改姓名           \n");
	printf("\t\t\t\t        2. 修改学号           \n");
	printf("\t\t\t\t        3. 修改班级           \n");
	printf("\t\t\t\t        4. 修改高数成绩       \n");
	printf("\t\t\t\t        5. 修改英语成绩       \n");
	printf("\t\t\t\t        6. 修改C语言成绩      \n");
	printf("\t\t\t\t        0. 返回上一页         \n");
	printf("\t\t\t\t******************************\n");
	printf("\t\t\t\t请选择:>");
}
void Modify(Node*head)
{
	Node* p = head->next;
	char a[20];
	system("cls");
	printf("\t\t\t\t请输入被修改者的学号:>");
	scanf("%s", a);
	while (p != NULL)
	{
		if (strcmp(a, p->number) == 0)
		{
			system("cls");
			text6(p);
			while (1)
			{
				char j[20];
				int b;
				scanf("%s", j);
				if (strlen(j) != 1)
				{
					printf("\t\t\t\t选择错误！\n");
					printf("\t\t\t\t请重新选择:>");
					continue;
				}
				b = j[0] - '0';
				switch (b)
				{
				case 1://修改姓名
					printf("\t\t\t\t现在的姓名:%s\n", p->name);
					printf("\t\t\t\t您要修改为:>");
					scanf("%s", p->name);
					printf("\t\t\t\t修改成功！\n");
					system("pause");
					system("cls");
					text6(p);
					break;
				case 2://修改学号
					printf("\t\t\t\t现在的学号为:%s\n", p->number);
					printf("\t\t\t\t您要修改为:>");
					while (1) {
						int flag = 0;
						int flag1 = 0;
						scanf("%s", p->number);
						if (strlen(p->number) != 5) {
							printf("\t\t\t\t学号要求5位数字！\n");
							printf("\t\t\t\t请输入正确的学号:>");
							continue;
						}
						for (int j = 0; j < 5; j++) {
							if (p->number[j] < '0' || p->number[j]>'9') {
								printf("\t\t\t\t学号要求5位数字！\n");
								printf("\t\t\t\t请输入正确的学号:>");
								flag = 1;
								break;
							}
						}
						if (flag == 0) {
							Node* newhead = head->next;
							while (newhead != p)
							{
								if (strcmp(newhead->number, p->number) == 0)
								{
									printf("\t\t\t\t该学号已被录入！\n");
									printf("\t\t\t\t请重新输入学号:>");
									flag1 = 1;
									break;
								}
								newhead = newhead->next;
							}
							if (flag1 == 0)
							{
								break;
							}
						}
					}
					printf("\t\t\t\t修改成功！\n");
					system("pause");
					system("cls");
					text6(p);
					break;
				case 3://修改班级
					printf("\t\t\t\t现在的班级为:%s\n", p->Class);
					printf("\t\t\t\t您要修改为:>");
					while (1) {
						int flag = 0;
						scanf("%s", p->Class);
						if (strlen(p->Class) != 4) {
							printf("\t\t\t\t请输入正确的班级:>");
							continue;
						}
						for (int j = 0; j < 4; j++) {
							if (p->Class[j] < '0' || p->Class[j]>'9') {
								printf("\t\t\t\t请输入正确的班级:>");
								flag = 1;
								break;
							}
						}
						if (flag == 0) {
							break;
						}
					}
					printf("\t\t\t\t修改成功！\n");
					system("pause");
					system("cls");
					text6(p);
					break;
				case 4://修改数学成绩
					printf("\t\t\t\t现在的高数成绩为:%d\n", p->math);
					printf("\t\t\t\t您要修改为:>");
					char math[5];
					while (1) {
						int flag = 0;
						scanf("%s", math);
						if (strlen(math) >= 3 && strcmp(math, "100") != 0) {
							printf("\t\t\t\t请输入正确的高数成绩:>");
							continue;
						}
						for (int j = 0; j < 2; j++) {
							if (math[j] == '\0') {
								break;
							}
							if (math[j] < '0' || math[j]>'9') {
								printf("\t\t\t\t请输入正确的高数成绩:>");
								flag = 1;
								break;
							}
						}
						if (flag == 0) {
							if (strlen(math) == 1) {
								p->math = math[0] - '0';
							}
							else if (strlen(math) == 2) {
								p->math = (math[0] - '0') * 10 + (math[1] - '0');
							}
							else
								p->math = 100;
							break;
						}
					}
					printf("\t\t\t\t修改成功！\n");
					system("pause");
					system("cls");
					text6(p);
					break;
				case 5://修改英语成绩
					printf("\t\t\t\t现在的英语成绩为:%d\n", p->English);
					printf("\t\t\t\t您要修改为:>");
					char English[5];
					while (1) {
						int flag = 0;
						scanf("%s", English);
						if (strlen(English) >= 3 && strcmp(English, "100") != 0) {
							printf("\t\t\t\t请输入正确的英语成绩:>");
							continue;
						}
						for (int j = 0; j < 2; j++) {
							if (English[j] == '\0') {
								break;
							}
							if (English[j] < '0' || English[j]>'9') {
								printf("\t\t\t\t请输入正确的英语成绩:>\n");
								flag = 1;
								break;
							}
						}
						if (flag == 0) {
							if (strlen(English) == 1) {
								p->English = English[0] - '0';
							}
							else if (strlen(English) == 2) {
								p->English = (English[0] - '0') * 10 + (English[1] - '0');
							}
							else
								p->English = 100;
							break;
						}
					}
					printf("\t\t\t\t修改成功！\n");
					system("pause");
					system("cls");
					text6(p);
					break;
				case 6://修改C语言成绩
					printf("\t\t\t\t现在的C语言成绩为:%d\n", p->CL);
					printf("\t\t\t\t您要修改为:>");
					char CL[5];
					while (1) {
						int flag = 0;
						scanf("%s", CL);
						if (strlen(CL) >= 3 && strcmp(CL, "100") != 0) {
							printf("\t\t\t\t请输入正确的C语言成绩:>");
							continue;
						}
						for (int j = 0; j < 2; j++) {
							if (CL[j] == '\0') {
								break;
							}
							if (CL[j] < '0' || CL[j]>'9') {
								printf("\t\t\t\t请输入正确的C语言成绩:>");
								flag = 1;
								break;
							}
						}
						if (flag == 0) {
							if (strlen(CL) == 1) {
								p->CL = CL[0] - '0';
							}
							else if (strlen(CL) == 2) {
								p->CL = (CL[0] - '0') * 10 + (CL[1] - '0');
							}
							else
								p->CL = 100;
							break;
						}
					}
					printf("\t\t\t\t修改成功！\n");
					system("pause");
					system("cls");
					text6(p);
					break;
				case 0://返回上一页
					system("cls");
					return 0;
				default :
					printf("\t\t\t\t选择错误！\n");
					printf("\t\t\t\t请重新选择:>");
					break;
				}
				Node* cur = head;
				p->total = p->English + p->math + p->CL;
				FILE* fp = fopen("text.txt", "wb");
				cur = cur->next;
				while (cur != NULL)
				{
					fwrite(cur, sizeof(Node), 1, fp);
					cur = cur->next;
				}
				rewind(fp);
				fclose(fp);
			}
		}
		p = p->next;
	}
	printf("\t\t\t\t该学号不存在！\n");
	system("pause");
	system("cls");
}
void Delete(Node* head)
{
	char a[20];
	Node* p = head;
	Node* q;
	system("cls");
	printf("\t\t\t\t-----------欢迎使用删除学生信息功能------------\n");
	printf("\t\t\t\t请输入被删除学生的学号:>");
	while (1)
	{
		scanf("%s", a);
		while (p ->next!= NULL)
		{
			if (strcmp(a, p->next->number) == 0)
			{
				q = p->next;
				p->next= q->next;
				free(q);
				printf("\t\t\t\t删除成功！\n");
				Node* cur = head;
				FILE* fp = fopen("text.txt", "wb");
				cur = cur->next;
				while (cur != NULL)
				{
					fwrite(cur, sizeof(Node), 1, fp);
					cur = cur->next;
				}
				rewind(fp);
				fclose(fp);
				system("pause");
				system("cls");
				return ;
			}
			p = p->next;
		}
		printf("\t\t\t\t该学号不存在!\n");
		printf("\t\t\t\t请重新输入被删除学生的学号:>");
	}
}
int campare1(Node* x, Node* y)
{
	return (x->total) - (y->total);
}
int campare2(Node* x, Node* y)
{
	return (x->math) - (y->math);
}
int campare3(Node* x, Node* y)
{
	return (x->English) - (y->English);
}
int campare4(Node* x, Node* y)
{
	return (x->CL) - (y->CL);
}
void PartSort(Node* head,int (*campare)(Node *x,Node* y))
{
	int count = 0;
	Node* cur = head->next;
	Node* p, *q;
	p = head;
	while (cur)
	{
		count++;
		cur = cur->next;
	}
	for (int i = 0; i < count; i++)
	{
		for (int j = 0; j < count - 1 - i; j++)
		{

			int flag = campare(p->next, p->next->next);
			if (flag < 0)
			{
				q = p->next;
				p->next = q->next;
				p = p->next;
				q->next = p->next;
				p->next = q;
			}
			else
			{
				p = p->next;
			}
		}
		p = head;
	}
	cur = head;
	FILE* fp = fopen("text.txt", "wb");
	cur = cur->next;
	while (cur != NULL)
	{
		fwrite(cur, sizeof(Node), 1, fp);
		cur = cur->next;
	}
	rewind(fp);
	fclose(fp);
}
void Sort(Node*head,char*x)
{
	system("cls");
	text7();
	while (1)
	{
		char j[20];
		int b;
		scanf("%s", j);
		if (strlen(j) != 1)
		{
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
			continue;
		}
		b = j[0] - '0';
		switch (b)
		{
		case 1://按总分排序
			PartSort(head, campare1);
			printf("\t\t\t排序成功！\n");
			OutPut(head,x);
			return;
		case 2://按高数成绩排序
			PartSort(head, campare2);
			printf("\t\t\t排序成功！\n");
			OutPut(head, x);
			return;
		case 3://按英语成绩排序
			PartSort(head, campare3);
			printf("\t\t\t排序成功！\n");
			OutPut(head, x);
			return;
		case 4://按C语言成绩排序
			PartSort(head, campare4);
			printf("\t\t\t排序成功！\n");
			OutPut(head, x);
			return;
		case 0:
			system("cls");
			return;
		default:
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
			break;;
		}
	}
}
void Sort2(Node*head)
{
	while (1)
	{
		system("cls");
		text9();
		char j[20];
		int b;
		scanf("%s", j);
		if (strlen(j) != 1)
		{
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
			continue;
		}
		b = j[0] - '0';
		switch (b)
		{
		case 1:
			Sort(head, "2101");
			system("pause");
			system("cls");
			break;
		case 2:
			Sort(head, "2102");
			system("pause");
			system("cls");
			break;
		case 3:
			Sort(head, "2103");
			system("pause");
			system("cls");
			break;
		case 4:
			Sort(head, "2104");
			system("pause");
			system("cls");
			break;
		case 5:
			Sort(head, "2105");
			system("pause");
			system("cls");
			break;
		case 6:
			Sort(head, "1111");
			system("pause");
			system("cls");
			break;
		case 0://返回上一页
			system("cls");
			return;
		default:
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
			break;
		}
	}
}
int ** PartAnalysis(Node*head,char*x)
{
	Node* cur = head->next;
	//int count[4][7] = { 0 };//最高 最低  优秀人数  良好人数  及格人数  不及格人数
	int** count = (int**)calloc(4,sizeof(int*));
	for (int i = 0; i < 4; i++)
	{
		count[i] = (int*)calloc(7,sizeof(int*));
	}
	count[0][0] = cur->math;
	count[0][1] = cur->math;
	count[1][0] = cur->English;
	count[1][1] = cur->English;
	count[2][0] = cur->CL;
	count[2][1] = cur->CL;
	while (cur!=NULL)
	{
		if (strcmp(cur->Class, x) != 0 && strcmp(x, "1111")!= 0)
		{
			cur = cur->next;
			continue;
		}
		if (count[0][0] < cur->math)
		{
			count[0][0] = cur->math;
		}
		if (count[0][1] > cur->math)
		{
			count[0][1] = cur->math;
		}
		if (count[1][0] < cur->English)
		{
			count[1][0] = cur->English;
		}
		if (count[1][1] > cur->English)
		{
			count[1][1] = cur->English;
		}
		if (count[2][0] < cur->CL)
		{
			count[2][0] = cur->CL;
		}
		if (count[2][1] > cur->CL)
		{
			count[2][1] = cur->CL;
		}
		if (cur->math >=85)//优秀
		{
			count[0][2]++;
		}
		if (cur->math <85&&cur->math>=70)//良好
		{
			count[0][3]++;
		}
		if (cur->math < 70&&cur->math>=60)//及格
		{
			count[0][4]++;
		}
		if (cur->math <60)//不及格
		{
			count[0][5]++;
		}
		if (cur->English >= 85)//优秀
		{
			count[1][2]++;
		}
		if (cur->English < 85 && cur->English >= 70)//良好
		{
			count[1][3]++;
		}
		if (cur->English < 70 && cur->English >= 60)//及格
		{
			count[1][4]++;
		}
		if (cur->English < 60)//不及格
		{
			count[1][5]++;
		}
		if (cur->CL >= 85)//优秀
		{
			count[2][2]++;
		}
		if (cur->CL < 85 && cur->CL >= 70)//良好
		{
			count[2][3]++;
		}
		if (cur->CL < 70 && cur->CL >= 60)//及格
		{
			count[2][4]++;
		}
		if (cur->CL < 60)//不及格
		{
			count[2][5]++;
		}
		count[3][0]++;//总人数
		count[0][6] += cur->math;//高数总分
		count[1][6] += cur->English;//英语总分
		count[2][6] += cur->CL;//C语言总分
		cur = cur->next;
	}
	return count;
}
int flag = 0;
int** PartAnalysis2(Node* head)
{
	text10;
	while (1)
	{
		system("cls");
		text9();
		char j[20];
		int b;
		scanf("%s", j);
		if (strlen(j) != 1)
		{
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
			continue;
		}
		b = j[0] - '0';
		switch (b)
		{
		case 1:
			return PartAnalysis(head, "2101");
		case 2:
			return PartAnalysis(head, "2102");
		case 3:
			return PartAnalysis(head, "2103");
		case 4:
			return PartAnalysis(head, "2104");
		case 5:
			return PartAnalysis(head, "2105");
		case 6:
			flag = 1;
			return PartAnalysis(head, "1111");
		case 0://返回上一页
			system("cls");
			return;
		default:
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
			break;
		}
	}
}
void Analysis(Node*head)
{
	int** a = PartAnalysis2(head);
	system("cls");
	printf("\t\t\t---------------欢迎使用成绩分析功能---------------\n");
	printf("成绩分析如下:\n\n");
	printf("\t _____________________________________________________________________________________________________________________\n");
	printf("\t|       |   最高分  |   最低分  |    优秀(100-90)    |  良好(90-70)   |  及格(70-60)  |  不及格(60以下)   |   平均分  |\n");
	printf("\t|―――――――――――-----------――――――――――――――----------------------------------------―--------------|\n");
	printf("\t| 高数  |    %-3d    |     %-2d    |     %-2d人(%-5.1f%%)   |  %-2d人(%-5.1f%%)  |  %-2d人(%-5.1f%%) |    %-2d人(%-4.1f%%)    |     %-4.1f  |\n", a[0][0], a[0][1], a[0][2],( 100*a[0][2]) / (a[3][0] * 1.0), a[0][3], (100*a[0][3]) / (a[3][0] * 1.0), a[0][4], (100*a[0][4]) / (a[3][0] * 1.0), a[0][5], (100* a[0][5]) / (a[3][0] * 1.0), a[0][6] / (a[3][0] * 1.0));
	printf("\t|―――――――――――-----------――――――――――――――----------------------------------------―----------―--|\n");
	printf("\t| 英语  |    %-3d    |     %-2d    |     %-2d人(%-5.1f%%)   |  %-2d人(%-5.1f%%)  |  %-2d人(%-5.1f%%) |    %-2d人(%-4.1f%%)    |     %-4.1f  |\n", a[1][0], a[1][1], a[1][2], (100*a[1][2] )/ (a[3][0] * 1.0), a[1][3], (100*a[1][3]) / (a[3][0] * 1.0), a[1][4], (100*a[1][4]) / (a[3][0] * 1.0), a[1][5], (100* a[1][5]) / (a[3][0] * 1.0), a[1][6] / (a[3][0] * 1.0));
	printf("\t|―――――――――――-----------――――――――――――――----------------------------------------―----------―--|\n");
	printf("\t| C语言 |    %-3d    |     %-2d    |     %-2d人(%-5.1f%%)   |  %-2d人(%-5.1f%%)  |  %-2d人(%-5.1f%%) |    %-2d人(%-4.1f%%)    |     %-4.1f  |\n", a[2][0], a[2][1], a[2][2], (100*a[2][2]) / (a[3][0] * 1.0), a[2][3], (100*a[2][3]) / (a[3][0] * 1.0), a[2][4], (100*a[2][4]) / (a[3][0] * 1.0), a[2][5], (100* a[2][5]) / (a[3][0] * 1.0), a[2][6] / (a[3][0] * 1.0));
	printf("\t|_____________________________________________________________________________________________________________________|\n");
	system("pause");
	system("cls");
	/*if (flag == 1)
	{
		int **one = PartAnalysis(head, "2101");
		int **two = PartAnalysis(head, "2102");
		int **three = PartAnalysis(head, "2103");
		int **four = PartAnalysis(head, "2104");
		int **five = PartAnalysis(head, "2105");
		double Average_max[2] = 0, Average_min[2] = { 0,999 };
		double ExtRate_max[2] = 0, ExtRate_min[2] = { 0,999 };
		double PassRate_max[2] = 0, PassRate_min[2] = { 0,999 };
		if()
	}*/
}

void CheckScore(Node* head,char*x)
{
	head = head->next;
	system("cls");
	while (strcmp(head->number, x) != 0) {
		head = head->next;
	}
	printf("\t\t __________________________________________\n");
	printf("\t\t|   高数   |   英语   |   C语言  |   总分  |\n");
	printf("\t\t|------------------------------------------|\n");
	printf("\t\t|    %-3d   |   %-3d    |   %-3d    |   %-3d   |\n", head->math, head->English, head->CL, head->CL + head->math + head->English);
	printf("\t\t|__________________________________________|\n");
	system("pause");
	system("cls");
}
void Analysis_stu(Node* head,char* x)
{
	PartSort(head, campare1);
	Node* p = head->next;
	int count = 1;
	int count1 = 1;
	int count2 = 1;
	while (p->next != NULL)
	{
		count++;
		p = p->next;
	}
	p = head->next;
	while (strcmp(x, p->number) != 0)
	{
		count1++;
		p = p->next;
	}
	char* cls = p->Class;
	p = head->next;
	while (strcmp(x, p->number) != 0)
	{
		if (strcmp(cls, p->Class) != 0)
		{
			p = p->next;
			continue;
		}
		count2++;
		p = p->next;
	}
	printf("\t\t\t\t总分在全校排名为 %d , 在本班级中排名为 %d \n",count1,count2);
	if (count1 / (count * 1.0) < 0.2)
		printf("\t\t\t\t总体成绩十分优秀，继续保持！\n\n\n");
	else if (count1 / (count * 1.0 )< 0.6)
		printf("\t\t\t\t总体成绩良好，继续努力！\n\n\n");
	else
		printf("\t\t\t\t总体成绩不是很理想，还需要继续努力！\n\n\n");
	 count1 = 1;
	 count2 = 1;
	 PartSort(head, campare2);
	 p = head->next;
	while (strcmp(x, p->number) != 0)
	{
		count1++;
		p = p->next;
	}
	cls = p->Class;
	p = head->next;
	while (strcmp(x, p->number) != 0)
	{
		if (strcmp(cls, p->Class) != 0)
		{
			p = p->next;
			continue;
		}
		count2++;
		p = p->next;
	}
	printf("\t\t\t\t高数在全校排名为 %d , 在本班级中排名为 %d \n", count1, count2);
	if (count1 / (count * 1.0) < 0.2)
		printf("\t\t\t\t高数成绩十分优秀，继续保持！\n\n\n");
	else if (count1 / (count * 1.0) < 0.6)
		printf("\t\t\t\t高数成绩良好，继续努力！\n\n\n");
	else
		printf("\t\t\t\t高数成绩不是很理想，还需要继续努力！\n\n\n");
	count1 = 1;
	count2 = 1;
	PartSort(head, campare3);
	p = head->next;
	while (strcmp(x, p->number) != 0)
	{
		count1++;
		p = p->next;
	}
	cls = p->Class;
	p = head->next;
	while (strcmp(x, p->number) != 0)
	{
		if (strcmp(cls, p->Class) != 0)
		{
			p = p->next;
			continue;
		}
		count2++;
		p = p->next;
	}
	printf("\t\t\t\t英语在全校排名为 %d , 在本班级中排名为 %d \n", count1, count2);
	if (count1 / (count * 1.0) < 0.2)
		printf("\t\t\t\t英语成绩十分优秀，继续保持！\n\n\n");
	else if (count1 /( count * 1.0 )< 0.6)
		printf("\t\t\t\t英语成绩良好，继续努力！\n\n\n");
	else
		printf("\t\t\t\t英语成绩不是很理想，还需要继续努力！\n\n\n");
	count1 = 1;
	count2 = 1;
	PartSort(head, campare3);
	p = head->next;
	while (strcmp(x, p->number) != 0)
	{
		count1++;
		p = p->next;
	}
	cls = p->Class;
	p = head->next;
	while (strcmp(x, p->number) != 0)
	{
		if (strcmp(cls, p->Class) != 0)
		{
			p = p->next;
			continue;
		}
		count2++;
		p = p->next;
	}
	printf("\t\t\t\tC语言在全校排名为 %d , 在本班级中排名为 %d \n", count1, count2);
	if (count1 /( count * 1.0) < 0.2)
		printf("\t\t\t\tC语言成绩十分优秀，继续保持！\n");
	else if (count1 /( count * 1.0) < 0.6)
		printf("\t\t\t\tC语言成绩良好，继续努力！\n");
	else
		printf("\t\t\t\tC语言成绩不是很理想，还需要继续努力！\n");
	system("pause");
	system("cls");
}
void Appeal(char* x, Node* head)
{
	Node* p = head->next;
	Mb a;
	a.flag = 1;
	while (strcmp(p->number, x) != 0)
	{
		p = p->next;
	}
	strcpy(a.name, p->name);
	strcpy(a.number,x);
	char content[200];
	printf("\t\t\t\t请输入你的申诉内容(150字以内)：\n");
	printf("\t\t\t\t");
	scanf("%s", content);
	strcpy(a.content,content);
	FILE* fp = fopen("Mailbox_Tea.txt","ab");
	if (fp == NULL)
	{
		printf("文件打开失败！");
		return;
	}
	fwrite(&a,sizeof(Mb),1,fp);
	fclose(fp);
	system("cls");
	printf("\t\t\t\t申诉成功，请耐心等待结果！\n");
	system("pause");
	system("cls");
}
void Mailbox_Tea()
{
	system("cls");
	FILE* fp = fopen("Mailbox_Tea.txt","rb");
	Mb b;
	if(fread(&b, sizeof(Mb), 1, fp) != 1)
	{
		printf("\t\t\t\t邮箱为空!");
		system("pause");
		system("cls");
		fclose(fp);
		return;
	}
	rewind(fp);
	while (fread(&b, sizeof(Mb), 1, fp) == 1)
	{
		printf("\t\t\t\t来自%s(%s)同学：%s\n\n",b.name,b.number,b.content);
	}
	system("pause");
	system("cls");
	fclose(fp);
	printf("\t\t\t\t-------1 清空邮箱    2 直接退出-------\n");
	char i[20];
	printf("\t\t\t\t请选择:>");
	
	while (1)
	{
		scanf("%s", i);
		if (strcmp(i, "2") == 0)
		{
			system("cls");
			return;
		}
		else if (strcmp(i, "1") == 0)
		{
			fp = fopen("Mailbox_Tea.txt","w");
			fclose(fp);
			printf("\t\t\t\t邮箱清空成功！\n");
			system("pause");
			system("cls");
			return;
		}
		else
		{
			printf("\t\t\t\t选择错误！\n");
			printf("\t\t\t\t请重新选择:>");
		}
	}
}
void Query(Node* head)//查询学生成绩
{
	printf("\t\t\t请输入您要查询学生的学号:>");
	char number[20];
	scanf("%s",number);
	while (1)
	{
		head = head->next;
		if (head == NULL) break;
		if (strcmp(number, head->number) == 0)
		{
			printf("\t\t __________________________________________\n");
			printf("\t\t|   高数   |   英语   |   C语言  |   总分  |\n");
			printf("\t\t|------------------------------------------|\n");
			printf("\t\t|    %-3d   |   %-3d    |   %-3d    |   %-3d   |\n", head->math, head->English, head->CL, head->CL + head->math + head->English);
			printf("\t\t|__________________________________________|\n");
			system("pause");
			system("cls");
			return;
		}
	}
	printf("\t\t\t被查询学号不存在！\n");
	system("pause");
	system("cls");
	return;
}
int Controller_Loge()
{
	printf("\t\t\t请输入特定的管理者账号:>");
	char number[15];
	scanf("%s",number);
	if (strcmp(number, "12345678")==0)
	{
		system("cls");
		printf("\t\t\t请输入密码:>");
		char password[15];
		scanf("%s",password);
		if (strcmp(password, "123456")==0)
		{
			printf("\t\t\t登录成功！\n");
			system("pause");
			system("cls");
			return 1;
		}
		printf("\t\t\t密码错误！\t");
		system("pause");
		system("cls");
		return 0;
	}
	else
	{
		printf("\t\t\t账号错误！\t");
		system("pause");
		system("cls");
		return 0;
	}
}
void Empower()
{
	system("cls");
	int flag = 1;
	char number[20];
	while (1)
	{
		printf("\t\t\t\t请输入您要授权的电话号:>");
		scanf("%s", number);
		if (strlen(number) != 11)
		{
			printf("\t\t\t\t错误的电话号码！\n");
			system("pause");
			system("cls");
			return;
		}
		for (int i = 0; i < 11; i++)
		{
			if (number[i] >= '0' && number[i] <= '9')
			{
				continue;
			}
			else
			{
				printf("\t\t\t\t错误的电话号码！\n");
				system("pause");
				system("cls");
				return;

			}

		}
		FILE* fp = fopen("phone.txt","rb");
		char number2[20];
		while (fread(number2,sizeof(number2),1,fp)==1)
		{
			if (strcmp(number, number2) == 0)
			{
				printf("\t\t\t\t该电话号已被授权！\n");
				system("pause");
				system("cls");
				fclose(fp);
				return;
			}
		}
		fclose(fp);
		fp = fopen("phone.txt", "ab");
		fwrite(number,sizeof(number),1,fp);
		system("cls");
		printf("\t\t\t授权成功！\n");
		system("pause");
		system("cls");
		printf("\t\t\t\t-------1 继续添加    2 退出-------\n");
		char a[15];
		while (1)
		{
			
			printf("\t\t\t\t请选择:>");
			scanf("%s", a);
			system("cls");
			if (strcmp(a, "1") == 0)
			{
				system("cls");
				break;
			}
			else if (strcmp(a, "2")==0)
			{
				fclose(fp);
				system("cls");
				return;
			}
			else
			{
				system("cls");
				printf("\t\t\t\t错误选择，请重新选择!\n");
			}
		}
	}
}
void Dele_Phone()
{
	system("cls");
	typedef struct phone
	{
		char number[20];
		struct phone* next;
	}Phone;
	printf("\t\t\t\t请输入你要删除的授权电话:>");
	char number[20];
	scanf("%s", number);
	if (strlen(number) != 11)
	{
		printf("\t\t\t\t错误的电话号码！\n");
		system("pause");
		system("cls");
		return;
	}
	for (int i = 0; i < 11; i++)
	{
		if (number[i] >= '0' && number[i] <= '9')
		{
			continue;
		}
		else
		{
			printf("\t\t\t\t错误的电话号码！\n");
			system("pause");
			system("cls");
			return;

		}
	}
	char number2[20];
	FILE* fp = fopen("phone.txt", "rb");
	while (fread(number2, sizeof(number), 1, fp) == 1)
	{
		if (strcmp(number2, number) == 0)
		{
			rewind(fp);
			Phone* head = malloc(sizeof(Phone));
			head->next = NULL;
			Phone* s = head;
			while (fread(number2, sizeof(number2), 1, fp) == 1)
			{
				Phone* r = malloc(sizeof(Phone));
				strcpy(r->number,number2);
				s->next = r;
				s = s->next;
				r->next = NULL;
			}
			fclose(fp);
			s = head;
			while (strcmp(s->next->number, number) != 0)
			{
				s = s->next;
			}
			s->next = s->next->next;
			fp = fopen("phone.txt", "wb");
			s = head->next;
			while (s != NULL)
			{
				fwrite(s->number, sizeof(number), 1, fp);
				s = s->next;
			}
			fclose(fp);
			system("cls");
			printf("\t\t\t\t删除成功！\n");
			system("pause");
			system("cls");
			fp = fopen("user.txt","rb");
			User a;
			while (fread(&a, sizeof(User), 1, fp) == 1)
			{
				if (strcmp(a.number, number) == 0)
				{
					rewind(fp);
					User* head2 = malloc(sizeof(User));
					User* s2 = head2;
					while (fread(&a, sizeof(User), 1, fp) == 1)
					{
						User* r2 = malloc(sizeof(User));
						strcpy(r2->account, a.account);
						strcpy(r2->name, a.name);
						strcpy(r2->number,a.number);
						strcpy(r2->password, a.password);
						s2->next = r2;
						s2 = s2->next;
					}
					s2->next = NULL;
					fclose(fp);
					s2 = head2;
					while (strcmp(s2->next->number, number) != 0)
					{
						s2 = s2->next;
					}
					s2->next = s2->next->next;
					fp = fopen("user.txt", "wb");
					s2 = head2->next;
					while (s2 != NULL)
					{
						fwrite(s2, sizeof(User), 1, fp);
						s2 = s2->next;
					}
					fclose(fp);
				}
			}
			return;
		}
	}
	printf("\t\t\t\t该电话号未被授权！\n");
	system("pause");
	system("cls");
	return;
}
void SeePhone()
{
	system("cls");
	int flag = 1;
	FILE* fp = fopen("phone.txt", "rb");
	char number[20];
	int cnt = 0;
	while (fread(number, sizeof(number), 1, fp) == 1)
	{
		if (flag == 1)
		{
			printf("\t\t\t\t已授权手机号:>");
			flag = 0;
		}
		cnt++;
		printf("%s  ", number);
		if (cnt % 4 == 0)
		{
			printf("\n\t\t\t\t  ");
		}
	}
	fclose(fp);
	fp = fopen("user.txt","rb");
	User a;
	flag = 1;
	printf("\n\n");
	while (fread(&a, sizeof(User), 1, fp) == 1)
	{
		if (flag == 1)
		{
			printf("\t\t\t\t已注册账号:\n");
			flag = 0;
		}
		printf("\t\t\t\t ____________________________\n");
		printf("\t\t\t\t|  姓名     |    %-6s      |\n", a.name);
		printf("\t\t\t\t|----------------------------|\n");
		printf("\t\t\t\t|  授权电话 |  %-11s   |\n", a.number);
		printf("\t\t\t\t|----------------------------|\n");
		printf("\t\t\t\t|  账号     |  %-8s      |\n", a.account);
		printf("\t\t\t\t|----------------------------|\n");
		printf("\t\t\t\t|  密码     |  %-10s    |\n", a.password);
		printf("\t\t\t\t|____________________________|\n");
	}
	fclose(fp);
	system("pause");
	system("cls");
}